---
title: ライブラリの配布とバージョン管理
---

数値計算をRustで行う為のライブラリを紹介していく前に、まずライブラリについての考え方をまとめておきましょう。

crate
------
Rustでは開発者がライブラリを公開する際の単位としてcrateというものが言語レベルで定められています。例えば配布方法が言語側で定められていないC++ではユーザーの環境毎にどのように外部ライブラリを取得するかに膨大な選択肢とそれに応じた手順が存在し、それによって外部のライブラリを使用することそれ自体が極めて専門性の高い技術となります。一方PythonやRuby、Node.jsなどでは配布方法を標準化しており、これにより自動的に外部ライブラリを決まった手順で取得する事が可能になるため外部ライブラリを使用するコストが激減し、より細かい単一の責任を負う単純なライブラリを開発する事が可能となります。ユーザーは多くのライブラリから自分が必要なものだけを選択し、それらを組み合わせる事で自分の実現したいソフトウェアを作成することになります。

crateを作る部分については公式のチュートリアル[Cargoでプロジェクトを作成する][cargo-new]が詳しいのでこちらを確認してください。

crateの配布と取得
-----------------
ライブラリはGitによる個々の変更に対するバージョン管理機構に加えて、リリースという単位でバージョンを管理します。典型的にはGitのタグと対応します。開発者はソフトウェアが他人の使用に耐えうると判断した段階でリリースを行います。一度リリースされたものは番号が付与され将来に渡って同一であり、新たなリリースを行う際には別の番号を付与します。これによりいつでも過去のバージョンのソフトウェアを取得出きるようになります。

crateは`cargo publish`コマンドによって[crates.io][crates.io]に公開されます。これは[Rust Foundation](https://foundation.rust-lang.org/)によって運営されている公式のcrateレジストリです。別のレジストリを使うことも出来ますがここでは割愛します。この際`major.minor.patch`の形で番号が付与されます。これは`cargo publish`時の`Cargo.toml`にある：

```toml:Cargo.toml
[package]
version = "0.1.2"
```

によって定まります。この例では`major=0`, `minor=1`, `patch=2`になります。これは実体としてはソースコードのアーカイブになります。`cargo`ビルドシステムは`Cargo.toml`内の`[dependencies]`句にしたがって依存しているライブラリのソースコードを[crates.io][crates.io]から取得し、それをビルドしてリンクします。

```toml:Cargo.toml
[dependencies]
num-traits = "0.3.0"
```

例えば次の節で解説する[num-traits][num-traits]を取得して使用するには上のように書きます。この際名前`num-triats`とバージョン番号`0.3.0`を頼りに`cargo`は[crates.io][crates.io]からcrateを探します。

Semantic Versioning
--------------------
現代のプログラミングでは多くのパッケージを組み合わせて使うことが前提となりますが、一方で最初から正しいAPIを設計は非常に困難です。故にライブラリの開発が進むにつれて互換性を破壊するような更新を入れるタイミングはどうしても必要となりますが、ライブラリのAPIが変更されればそれに依存しているソフトウェアにも変更が必要になります。この作業を安全に行うために安全に破壊的な変更を行う方法が必要となります。その互換性を機械可読な形で提供するのが[semantic versioning][semver]の目的です。

[cargo-new]: https://doc.rust-jp.rs/book-ja/ch01-03-hello-cargo.html#cargo%E3%81%A7%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B
[crates.io]: https://crates.io/
[num-traits]: https://github.com/rust-num/num-traits
[semver]: https://semver.org/lang/ja/
