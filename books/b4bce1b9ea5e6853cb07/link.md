---
title: リンクと共有ライブラリ
---

ここではRustと他の言語との相互運用についての準備として、Linuxにおけるオブジェクトファイルのリンクと、共有ライブラリのロードに関する話をします。これはOS（カーネルに加えて開発用のツールチェインを含めた意味）に強く依存する部分ですが、WindowsやmacOSでもいくつかの環境変数やコマンドを読み替えるだけで概ね同じになる範囲を扱います。

実行可能なファイルとリンク
-------------------------
Rustで実行可能なターゲット (`src/bin/main.rs`のようなファイル) を含むプロジェクトをビルドすると実行ファイルが出来上がりますが、どうしてOSはこれを実行できるのでしょうか？OSはそれぞれが実行可能なファイルのフォーマットを規定していて、それにそってファイルを作成することで実行可能なファイルを作成できます。Linuxでは[ELF (Executable and Linkable Format)](https://ja.wikipedia.org/wiki/Executable_and_Linkable_Format)というフォーマットが使われています。

その名の通りELFにはリンク可能なファイルを格納する事が出来ます。例えば数百ファイルのソースコードからなるプロジェクトがあるとしましょう。これらのソースコードをコンパイルして一つの実行可能なファイルを一気に作るのは大変なので、それぞれのソースコードファイルを個別にコンパイルして、最後にそれらを結合出来ると便利です。この結合処理の事をリンクと呼び、個別にコンパイルされたデータを保存したファイルをオブジェクトファイルと呼びます。オブジェクトファイルもELF形式で保存することができ、ファイル名に`.o`という拡張子を使うことが多いです。

共通基盤としてのC言語
--------------------
以下ではリンクについての基本的な事項をC言語で説明していきます。何故ならリンクのためのツールはまずC言語で動くように設計されており、なのでC言語の基本的な概念がそのままリンクの基本的な概念として現れるからです。Rustや他の多くの言語 (例えばC++) はC言語におけるリンクの仕組みの上に追加の情報を付加することで、ツールをそのまま利用しつつより高度なリンクを実現しています。
