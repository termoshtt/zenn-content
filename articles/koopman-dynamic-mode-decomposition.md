---
title: "動的モード分解(DMD)とKoopman作用素"
emoji: "📦"
type: "idea"
topics: ["math"]
published: true
---

この記事では時系列解析の手法の一つである動的モード分解(Dynamic mode decomposition, DMD)をKoopman作用素との関係を中心に解説する。

状態空間モデル
------------
まず解析の前提となる設定についてまとめていく。この記事ではある一定の時間間隔($\Delta t$と書く)で、有限個(以降$N$とする)の実数値のデータが得られるシステムを考え、その挙動を解析したいとする。各時刻$t_i = i \Delta t$, $i = 0, \ldots, T$に対して得られるデータを$x_i \in \mathbb{R}^N$と書く。またシステムの状態を表す全ての変数を観測できるとは限らないので、各時刻$t_i$における真の状態を$z_i$と書き、そこから$x_i$を生成する過程を観測と呼び$x_i = H(z_i)$と書くことにしよう。観測に対応する関数$H$が$i$に依存しないのは観測の方法は時刻に依存しないことを意図している。

真の状態$z_i$がひとつ前の状態$z_{i-1}$によってだけ定まるシステムのことをマルコフ的であるという。この関係を$z_i = F(z_{i-1})$と書く。$f$を時間発展と呼び、これも時刻に依らないと仮定する。物理的な系においては時間発展は時間に関する微分方程式で与えられる(これを運動方程式と呼ぶ)事が多いが、適当な時間間隔について積分することでこの形になる。この$z_i$が属するノルム線形空間を$V$と書き状態空間と呼ぶことにしよう。これも時刻には依らない、あるいは全ての時刻について内包できるように$V$を取れると仮定する。さらに$F: V \to V$および$H: V \to \mathbb{R}^N$は連続であると仮定する。

さらに解析したいシステムは定常的であると仮定する。この時状態空間の部分集合$A \subset V$として$F$で不変な集合

$$
F(A) = A
$$

となる集合が取れる。例えばリミットサイクルを示す力学系を一定の時間間隔で積分したシステムでは$A$はそのリミットサイクルになり、ローレンツモデルのような場合には$A$はカオティックアトラクタとなる。このような$A$を不変集合と呼ぶ。

Koopman作用素
-------------
時間発展$F: V \to V$を解析することが目的だが、これは非線形な関数なのでそのままだと解析が難しい。そこで少しテクニカルな方法で線形作用素のスペクトルに変換する。

不変集合$A$の$V$での閉包$\bar{A}$における連続関数全体

$$
X = \operatorname{Hom}(\bar{A}, \mathbb{R}) = \lbrace f: \bar{A} \to \mathbb{R}; \text{連続} \rbrace
$$

を考えると、これには$f, g \in X$とスカラー$a \in \mathbb{R}$に対して新しい関数$f + g, af \in X$を各$z \in \bar{A}$に対して

$$
(f + g)(z) = f(z) + g(z), \space (af)(z) = a f(z)
$$

で定義することで線形空間となる。

この関数空間には次のように内積が入る。適切な仮定の元で任意の$f \in X$に対して

$$
\int f(z) d\mu(z) = \lim_{T \to \infty} \frac{1}{T} \sum_{i=1}^T f(F^i(z_0))
$$

がほとんどすべての$z_0$について成り立つような$A$上の確率測度$\mu$が存在することが知られており、この測度は部分集合$B \subset A$について

$$
\mu(F^{-1}(B)) = \mu(B)
$$

を満たすので$F$-不変確率測度と呼ばれる。これを使って$f, g \in X$に対して内積を

$$
(f, g) = \int f(z) g(z) d\mu(z)
$$

と定めノルムを$\| f \| = \sqrt{(f, f)}$とする。

ある$f \in X$に対して、時間発展$F: V \to V$を右から作用させた関数$f \circ F$を考えるとこれは再び$X$の元になり、$f, g \in X$と$z \in V$について

$$
\begin{align*}
((f+g) \circ F)(z) &= (f+g)(F(z)) \\
& = f(F(z)) + g(F(z)) \\
&= (f \circ F)(z) + (g \circ F)(z) = (f \circ F + g \circ F)(z)
\end{align*}
$$

なので$f \mapsto f \circ F$は$X$の線形空間の構造について線形となり、この線形写像を$\Phi_F: X \to X$と書く。さらに上の内積より定まるノルムに対して$\Phi_F$は等長的、つまり $\| \Phi_F(f) \| = \| f \|$が成り立つ。

動的モード分解
--------------
さて観測データ$x_i$から線形写像$\Phi_F$を回帰することを考えよう。

まず注意しないといけないのは$V$が有限次元であっても$X$は無限次元になることである。$\Phi_F$は$X$上の線形写像なので一般に行列では表現できず、なので計算機で表現できるとは限らない。数学的には$F$がどのような性質を持つときに適当な$\Phi_F$の近似が可能になるのかを考えるべきだが、応用上は$\Phi_F$をとりあえず適当な$X$の部分空間上で評価してみてどの程度$F$の情報を取り出せたのかを調べる。

$X$の部分空間として、何か一つ$f \in X$を固定してこれを$\Phi_F$によって反復すると

$$
f, \Phi_F(f), \Phi_F^2(f), \ldots
$$

という列ができることを利用し、これを順番に直交化することで部分空間を作っていく。つまりまず$f_0 = f / \| f \|$と定め、

$$
\begin{align*}
  g_{j+1} &= \Phi_F(f_j) \\
  l_{j+1} &= g_{j+1} - \sum_{k=0}^j (f_k, g_{j+1}) f_k \\
  f_{j+1} &= l_{j+1} / \| l_{j+1} \|
\end{align*}
$$

によって互いに直交する規格化されたベクトル$f_j \in X$を生成していく。ただし途中で$l_{j+1} = 0$になったときは$f_j$までで止めることにする。
これらを基底とする空間

$$
X^j(f) = \operatorname{Span}\lbrace f_0, \ldots, f_{j-1} \rbrace \subset X
$$

を考えると$X^{j+1}(f)$が存在する時これは構成より明らかに $\Phi_F(X^j(f)) \subset X^{j+1}(f)$ を満たすので、これを$f_j$を横に並べることで行列のように書くと

$$
\Phi_F \left(f_0 \cdots f_{j-1} \right) = \left(f_0 \cdots f_j \right)
\begin{pmatrix}
    * & \cdots & \cdots & * \\
    * & \cdots & \cdots & * \\ 
    0 & *      & \cdots & * \\
    \vdots & \ddots & \ddots & \vdots \\
    0 & \cdots & 0      & *
\end{pmatrix}
$$

と書ける。この右辺の係数行列を$\Psi_F$と書くことにする。これは上三角行列にもう一列足したものでHessenberg行列と呼ばれる。このように演算子がある時に一つのベクトルに対する反復を直交化することによって基底を作り、その基底のなす部分空間で演算子をHessenberg行列として表現する手法は疎行列の反復解法の一つとしてArnoldi法と知られている。係数の組から$X^j(f)$の元を定める写像

$$
\psi_j: \mathbb{R}^j \ni (a_0, \ldots, a_{j-1}) \longmapsto \sum_{k=0}^{j-1} a_k f_k \in X^j(f)
$$

を考えると、上の行列$\Psi_F$は次の図式を可換にするように作っていることが分かる

$$
\begin{CD}
   V^j(f) @>{\Phi_F}>> V^{j+1}(f) \\
   @A{\psi_j}AA  @AA{\psi_{j+1}}A \\
   \mathbb{R}^j @>{\Psi_F}>> \mathbb{R}^{j+1}
\end{CD}
$$